<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<!-- <link rel="stylesheet" href="css/treeMap.css" /> -->
		<link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/dashboard.css" />
        <link rel="stylesheet" href="css/keen-dashboards.css">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
		<title>Correlation</title> 
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity=
		"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> 
	</head>
    
    <!-- navbar -->
	<body class="application">
		<div class="container">
			<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
			  <div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
				  <span class="sr-only">Toggle navigation</span>
				  <span class="icon-bar"></span>
				  <span class="icon-bar"></span>
				  <span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="./">General informations</a>
			  </div>
			  <div class="navbar-collapse">
				<ul class="navbar-nav nav main-nav">
				  <li><a href="formations.html">Formations</a></li>
				  <li><a href="build_your_mobility.html">Build your mobility</a></li>
				  <li><a href="correlation_for_your_mobility.html">Correlation for your mobility</a></li>
				</ul>
			  </div>
			</div>
		</div>
         <!-- Title  --> 
        <h1 size="36">Dashboard Unita</h1>
        <p><div class="p2">This part of dashboard will help you find all the courses correlated to each other</div></p>

        <!-- Body --> 
        <div class="container-fluid">
            <div class="row">
			  <div class="col-sm-6">
				<div class="chart-wrapper">
					<div class="chart-stage">
                        <h1> Corelation form </h1>
                        <hr>	
                        <!-- Forms  --> 
                        <!-- input to select course  --> 
                        <div class="program_rect">
                            <input id="prog1" name="prog1" list="program1" placeholder="Write or choose a program from this list :" required/>
                            <datalist id="program1"></datalist>
                        </div>
                        </br>
                        </br>
                        <!-- submit --> 
                        <input type="submit" id="submitCorrelation" name="submitCorrelation" value="Submit" />
                        <!--  Script for generate the study program's name list --> 
                        <script>
                            var GlobalData;
                            var GlobalSubmit;
                            var submitvalue;
                            // get data from restfull API (course)
                            $.getJSON( "/api/data_table_courses", function( data ) {
                                let items = [];
                                GlobalData = data;
                                $.each( data, function( key, val ) {
                                    items.push( `<option value='${val.Program}-${val.University}'/>` );
                                });
                                // 1: we create a dataset, it allows to filter and remove duplicates
							    const uniqueSet = new Set(items);
							    // 2: we convert to an array using the spread operator
							    const backToArray = [...uniqueSet];
                                // 3: add this array to the html forms
                                $( "#program1" ).html(backToArray);
                            });
                            
                            // event --> click 
                            $("#submitCorrelation").click(function() {
                                for(data of GlobalData){
                                    submitvalue = $('#prog1').val();
                                    if(submitvalue==`${data.Program}-${data.University}`){
                                        GlobalSubmit = data;
                                        $( "#ECTS" ).html('ECTS : <b>'+ data.ECTS +'</b>');
                                        $( "#English_friendly" ).html('English_friendly : <b>'+data.English_friendly +'</b>');
                                        $( "#Program" ).html('Program : <b>'+data.Program +'</b>');
                                        $( "#Semester" ).html('Semester : <b>'+data.Semester +'</b>');
                                        $( "#Subject" ).html('Subject : <b>'+data.Subject +'</b>');
                                        $( "#University" ).html('University : <b>'+data.University +'</b>');
                                        $( "#Virtual_Mobility" ).html('Virtual_Mobility : <b>'+data.Virtual_Mobility +'</b>');
                                        break;
                                    }
                                }
                                // get data from restfull API (compatibility)
                                $.getJSON( "/api/data_compatibility", function( data ) {
                                    let items = [];
                                    // sort by compatibility the most relevant
                                    data = data.sort((a, b) => (a.compatibility > b.compatibility ? -1 : +1));
                                    // browse the table
                                    $.each( data, function( key, val ) {
                                        if ( submitvalue == val.program2 ||   submitvalue == val.program1) {
                                            // using for the number of star
                                            let compatibility = ''
                                            // title of the new section
                                            let title = '';
                                            // change color according to compatibility
                                            let color = '';
                                            if (val.compatibility){
                                                console.log(val.compatibility);
                                                compatibility += '&#11088;';
                                                for (let step = 1; step < val.compatibility; step++) {
                                                    compatibility += '&#11088;';
                                                }
                                                if (val.compatibility<3){
                                                    color = 'bg-warning';
                                                }else{
                                                    color = 'bg-success';
                                                }
                                            }else{
                                                compatibility = '0';
                                                color = 'bg-danger';
                                            }
                                            if (submitvalue == val.program2) {
                                                title = val.program1;
                                            }else{
                                                title = val.program2;
                                            }
                                            // add html section
                                            items.push( `
                                            <td>
                                                <div class="${color} chart-wrapper" style='width:500px;height:200px'>
                                                    <div class="chart-stage">
                                                        <h3>${title}</h3>
                                                        <div id="Correlation"> Correlation : <b>${compatibility}</b></div>
                                                        <div id="Program1">Program1 : <b>${val.program1}</b></div>
                                                        <div id="Program2">Program2 : <b>${val.program2}</b></div>
                                                        <div id="Comment">Comment: <b>${val.comment}</b></div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                &nbsp;
                                            </td>
                                            ` );
                                        }
                                    });
                                    $("#compatibility").html(items);
                                });
                            });
                        </script>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
				<div class="chart-wrapper">
					<div class="chart-stage">
                        <h1>Global informations </h1>	
                        <hr>
                        <div id="ECTS">ECTS : </div>
                        <div id="English_friendly">English_friendly : </div>
                        <div id="Program">Program : </div>
                        <div id="Semester">Semester : </div>
                        <div id="Subject">Subject : </div>
                        <div id="University">University : </div>
                        <div id="Virtual_Mobility">Virtual_Mobility : </div>
                    </div>
                </div>
            </div>
        </div>
        
        <table style='width: 100%;overflow-x: auto;display: block;'>
            <tbody>
                <tr id="compatibility">
                </tr>
            </tbody>
        </table>
       
	</body>
</html>